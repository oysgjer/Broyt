<!doctype html>
<html lang="no">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Br√∏yterute ‚Äì Romerike Trefelling (V9.3.2)</title>
<meta name="theme-color" content="#0f9d58">
<style>
  :root{
    --bg:#111; --fg:#f4f6f8; --muted:#b8c0c7;
    --card:#1a1a1a; --cardBorder:#2a2a2a;
    --green:#0f9d58; --red:#c21d03; --blue:#0061fe; --gray:#2f3337;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  body{background:var(--bg);color:var(--fg)}
  #app{min-height:100%;display:grid;grid-template-rows:auto 1fr auto}
  header{background:#0b0b0b;color:#fff;padding:10px 12px;display:flex;align-items:center;gap:10px}
  header h1{font-size:16px;margin:0}
  .spacer{flex:1}
  .nav{display:flex;gap:8px}
  .nav .tab{border:none;border-radius:12px;padding:8px 12px;background:#2a2a2a;color:#fff;cursor:pointer}
  .nav .tab.active{background:var(--green)}
  .page{display:none;padding:14px}
  .page.active{display:block}
  .card{background:var(--card);border:1px solid var(--cardBorder);border-radius:16px;padding:14px}
  .stack{display:flex;flex-direction:column;gap:12px}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .title-lg{font-size:26px;font-weight:700}
  .muted{color:var(--muted)}
  .btn{border:none;border-radius:14px;font-size:17px;font-weight:700;cursor:pointer}
  .btn.s{height:38px;font-size:14px;border:1px solid var(--cardBorder);background:#222;color:#fff}
  .btn-green{background:var(--green);color:#fff}
  .btn-red{background:var(--red);color:#fff}
  .btn-blue{background:var(--blue);color:#fff}
  .btn-gray{background:var(--gray);color:#fff}
  .item{background:var(--card);border:1px solid var(--cardBorder);border-radius:12px;padding:10px;margin-bottom:8px}
  .item.disabled{opacity:.5}
  .footer{background:#0b0b0b;color:#fff;padding:8px 12px;display:flex;justify-content:space-between;font-size:12px}
  input,select,textarea{background:transparent;color:inherit;border:1px solid var(--cardBorder);border-radius:10px;padding:8px}
</style>
</head>
<body>
<div id="app">
  <header>
    <h1>Br√∏yterute ‚Äì Romerike Trefelling</h1>
    <div class="spacer"></div>
    <div class="nav">
      <button type="button" class="tab active" data-tab="home">Hjem</button>
      <button type="button" class="tab" data-tab="work">Under arbeid</button>
      <button type="button" class="tab" data-tab="register">Adresse-register</button>
      <button type="button" class="tab" data-tab="service">Service</button>
    </div>
  </header>

  <!-- HJEM -->
  <div id="page-home" class="page active">
    <div class="card stack">
      <h2>Innstillinger</h2>
      <div class="row">
        <label style="min-width:90px;align-self:center">Sj√•f√∏r</label>
        <input id="driver" type="text" placeholder="Skriv inn navnet ditt" style="flex:1;min-width:220px">
      </div>
      <div class="row">
        <label><input id="eq_plog" type="checkbox"> Plog</label>
        <label><input id="eq_fres" type="checkbox"> Fres</label>
        <label><input id="eq_stro" type="checkbox"> Str√∏kasse</label>
      </div>
      <div class="row" style="justify-content:flex-end">
        <button id="btnStart" type="button" class="btn btn-green">Start runde ‚Üí</button>
      </div>
    </div>
  </div>

  <!-- UNDER ARBEID -->
  <div id="page-work" class="page">
    <div class="card stack">
      <div id="driverLbl" class="muted">Sj√•f√∏r: ‚Äî</div>
      <h2 id="curName" class="title-lg">‚Äî</h2>
      <div class="muted">Oppgave: <span id="curTask">‚Äî</span></div>
      <div class="muted">Neste: <span id="curNext">‚Äî</span></div>
      <div class="row">
        <button id="ongo"  type="button" class="btn btn-gray">‚ñ∂Ô∏è P√•g√•r</button>
        <button id="done"  type="button" class="btn btn-green">‚úÖ Ferdig</button>
        <button id="block" type="button" class="btn btn-red">‚õî Ikke mulig</button>
        <button id="nav"   type="button" class="btn btn-blue">üß≠ Naviger</button>
        <button id="next"  type="button" class="btn btn-gray">üîÅ Neste</button>
      </div>
    </div>
  </div>

  <!-- REGISTER -->
  <div id="page-register" class="page">
    <div id="list"></div>
    <div class="card stack">
      <div class="row">
        <input id="addr" type="text" placeholder="Adresse / omr√•de" style="flex:2">
        <select id="taskSel" style="flex:1">
          <option>Br√∏yte</option><option>Frese</option><option>Str√∏</option>
          <option>Br√∏yte og str√∏</option><option>Frese og str√∏</option><option>Br√∏ytestikker</option>
        </select>
        <button id="add" type="button" class="btn btn-green">+ Legg til</button>
      </div>
    </div>
  </div>

  <!-- SERVICE -->
  <div id="page-service" class="page">
    <div class="card stack">
      <h2>Service / Vedlikehold</h2>
      <div class="row">
        <label><input id="svc_plog" type="checkbox"> Smurt plog</label>
        <label><input id="svc_fres" type="checkbox"> Smurt fres</label>
        <label><input id="svc_stro" type="checkbox"> Smurt str√∏kasse</label>
        <label><input id="svc_other" type="checkbox"> Annet</label>
      </div>
      <textarea id="svcNotes" placeholder="Anmerkninger ‚Ä¶" style="width:100%;min-height:100px"></textarea>
    </div>
  </div>

  <div class="footer">
    <div id="pos">‚Äî</div>
    <div>Versjon 9.3.2</div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function(){
  // ------- Utils -------
  function $(id){ return document.getElementById(id); }
  function save(){ localStorage.setItem('broyte_state', JSON.stringify(state)); }
  function load(){ try{ return JSON.parse(localStorage.getItem('broyte_state')||''); }catch(e){ return null; } }
  function show(tab){
    ['home','work','register','service'].forEach(p=>{
      var page = $('page-'+p);
      if(page) page.classList.toggle('active', p===tab);
      var tabBtn = document.querySelector('.tab[data-tab="'+p+'"]');
      if(tabBtn) tabBtn.classList.toggle('active', p===tab);
    });
  }

  // ------- State (med trygg seed) -------
  var state = load() || {
    driver:'',
    equipment:{plog:true,fres:false,stro:false},
    stops:[
      {n:'AMFI Eidsvoll (R√•holt)', t:'Br√∏yte', f:false, b:false},
      {n:'R√•holt barneskole', t:'Br√∏yte og str√∏', f:false, b:false},
      {n:'R√•holt ungdomsskole', t:'Frese', f:false, b:false},
      {n:'Dal stasjon', t:'Str√∏', f:false, b:false}
    ]
  };

  // ------- Tabs -------
  document.querySelectorAll('.tab').forEach(btn=>{
    btn.addEventListener('click', function(){
      var tab=this.getAttribute('data-tab');
      show(tab);
      if(tab==='register') renderList();
      if(tab==='work') renderWork();
    });
  });

  // ------- Home / innstillinger -------
  if($('driver')) $('driver').value = state.driver || '';
  if($('driver')) $('driver').addEventListener('input', function(){ state.driver=this.value.trim(); save(); });
  if($('eq_plog')) {$('eq_plog').checked=!!state.equipment.plog; $('eq_plog').addEventListener('change', e=>{ state.equipment.plog=e.target.checked; save(); });}
  if($('eq_fres')) {$('eq_fres').checked=!!state.equipment.fres; $('eq_fres').addEventListener('change', e=>{ state.equipment.fres=e.target.checked; save(); });}
  if($('eq_stro')) {$('eq_stro').checked=!!state.equipment.stro; $('eq_stro').addEventListener('change', e=>{ state.equipment.stro=e.target.checked; save(); });}

  if($('btnStart')) $('btnStart').addEventListener('click', function(){
    // Tving visning av "Under arbeid"
    show('work');
    renderWork();
  });

  // ------- Under arbeid -------
  function getCurrent(){
    for(var i=0;i<state.stops.length;i++){
      var s=state.stops[i];
      if(!s.f && !s.b) return s;
    }
    return null;
  }
  function getNext(){
    var curFound=false;
    for(var i=0;i<state.stops.length;i++){
      var s=state.stops[i];
      if(!s.f && !s.b){
        if(!curFound){ curFound=true; continue; }
        return s;
      }
    }
    return null;
  }
  function renderWork(){
    var cur=getCurrent(), nxt=getNext();
    if($('driverLbl')) $('driverLbl').textContent = 'Sj√•f√∏r: ' + (state.driver||'‚Äî');
    if($('curName'))  $('curName').textContent  = cur?cur.n:'‚Äî';
    if($('curTask'))  $('curTask').textContent  = cur?cur.t:'‚Äî';
    if($('curNext'))  $('curNext').textContent  = nxt?nxt.n:'‚Äî';
  }

  function markDone(s){ s.f=true; save(); }
  function markBlocked(s){ s.b=true; save(); }

  if($('ongo')) $('ongo').addEventListener('click', function(){ renderWork(); });
  if($('done')) $('done').addEventListener('click', function(){
    var cur=getCurrent(); if(!cur) return;
    if(cur.t==='Br√∏ytestikker'){
      var n=prompt('Antall br√∏ytestikker?','');
      if(n===null) return;
      cur.details='Br√∏ytestikker: '+(parseInt(n||'0',10)||0);
    }
    markDone(cur); renderWork();
    var next=getCurrent();
    if(next && next.n){
      window.location.href='https://www.google.com/maps/dir/?api=1&destination='+encodeURIComponent(next.n);
    }
  });
  if($('block')) $('block').addEventListener('click', function(){
    var cur=getCurrent(); if(!cur) return;
    var r=prompt('Hvorfor ikke mulig √• utf√∏re? (valgfritt)','')||'';
    if(r) cur.details=(cur.details?cur.details+' ¬∑ ':'')+'√Örsak: '+r;
    markBlocked(cur); renderWork();
  });
  if($('nav')) $('nav').addEventListener('click', function(){
    var cur=getCurrent(); if(!cur) return;
    window.location.href='https://www.google.com/maps/dir/?api=1&destination='+encodeURIComponent(cur.n);
  });
  if($('next')) $('next').addEventListener('click', function(){
    var cur=getCurrent(); if(!cur) return;
    if(confirm('Vil du markere denne som ferdig f√∏r du g√•r videre?')){
      markDone(cur);
    }
    renderWork();
    var nxt=getCurrent();
    if(nxt && nxt.n){
      window.location.href='https://www.google.com/maps/dir/?api=1&destination='+encodeURIComponent(nxt.n);
    }
  });

  // ------- Register -------
  function renderList(){
    var el=$('list'); if(!el) return;
    var html='';
    for(var i=0;i<state.stops.length;i++){
      var s=state.stops[i];
      html += "<div class='item"+(s.f?' disabled':'')+"'>"
           +  "<b>"+(i+1)+". "+escapeHtml(s.n)+"</b><br>"
           +  "<span>"+escapeHtml(s.t)+"</span> "+(s.f?'‚úÖ':'')
           + "</div>";
    }
    el.innerHTML = html;
  }
  if($('add')) $('add').addEventListener('click', function(){
    var a=$('addr'), t=$('taskSel'); if(!a||!t) return;
    var name=(a.value||'').trim(); if(!name) return;
    state.stops.push({n:name,t:t.value,f:false,b:false});
    a.value=''; save(); renderList();
  });

  // ------- Footer (enkel status) -------
  if($('pos')) $('pos').textContent='Klar';

  // Sm√• hjelpere
  function escapeHtml(s){ return String(s).replace(/[&<>"']/g, function(ch){return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[ch])||ch;}); }

  // Start trygt p√• Hjem, men dersom du √∏nsker auto-videre, fjern kommentaren under:
  // if (state.driver) { show('work'); renderWork(); }
});
</script>
</body>
</html>