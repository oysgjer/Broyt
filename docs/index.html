<!doctype html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Brøyterute – v9.10 (Romerike Trefelling)</title>

  <!-- Tema-farge for mobilstatuslinje -->
  <meta name="theme-color" content="#0f9d58" />

  <!-- PWA-manifest (Del H) -->
  <link rel="manifest" href="manifest.json" />

  <!-- Stil (Del B) -->
  <link rel="stylesheet" href="del-B.css" />
</head>
<body>
  <!-- Root for dynamisk innlasting av Del A (markup) -->
  <div id="__boot">Laster …</div>

  <noscript>Du må aktivere JavaScript for å bruke Brøyterute.</noscript>

  <script>
    // Enkel, trygg sekvensiell laster for A→G
    (function () {
      const rootMarker = document.getElementById('__boot');

      function loadScript(src) {
        return new Promise((resolve, reject) => {
          const s = document.createElement('script');
          s.src = src;
          s.async = false;            // behold rekkefølgen
          s.onload = resolve;
          s.onerror = () => reject(new Error('Kunne ikke laste ' + src));
          document.head.appendChild(s);
        });
      }

      async function boot() {
        try {
          // 1) Hent og injiser Del A (HTML-skjellett)
          const res = await fetch('del-A.html', { cache: 'no-cache' });
          if (!res.ok) throw new Error('del-A.html svarte ikke (' + res.status + ')');
          const html = await res.text();

          // Bytt ut placeholder og sett faktisk markup i <body>
          // Vi bruker insertAdjacentHTML for å unngå å erstatte hele body-noden
          rootMarker.insertAdjacentHTML('beforebegin', html);
          rootMarker.remove();

          // 2) Last JS-delene i korrekt rekkefølge
          // C: konfig/state/helpers
          await loadScript('del-C.js');
          // D: synk, vær, foto, logging, live-posisjon
          await loadScript('del-D.js');
          // E: admin-kart/Leaflet
          await loadScript('del-E.js');
          // F: oppstart, wiring, PWA-registrering (kaller sw.js)
          await loadScript('del-F.js');
          // G: katalog-editor (admin)
          await loadScript('del-G.js');

          // Ferdig – Del F tar seg av første render og SW-registrering
          console.log('Brøyterute — alle deler lastet (A→G).');
        } catch (err) {
          console.error(err);
          // Myk feilmelding på skjermen
          const msg = document.createElement('div');
          msg.style.cssText = 'position:fixed;left:0;right:0;bottom:0;background:#b00020;color:#fff;padding:10px 12px;font:14px system-ui;z-index:99999';
          msg.textContent = 'Feil under oppstart: ' + (err && err.message ? err.message : err);
          document.body.appendChild(msg);
        }
      }

      boot();
    })();
  </script>
</body>
</html>