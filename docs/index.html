<!doctype html>
<html lang="no" data-theme="auto">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>Brøyt</title>

  <!-- Globalt tema -->
  <link rel="stylesheet" href="./theme.css">
  <script src="./shared/theme.js"></script>

  <!-- App-konfig -->
  <script>
    window.APP_CFG = {
      API_BASE: 'https://jsonbin-proxy.oysgjer.workers.dev/jsonbin/',
      BIN_ID: '68e7b4d2ae596e708f0bde7d',
      APP_VER: '9.12h – Romerike Trefelling'
    };
  </script>

  <!-- Felles state -->
  <script src="./shared/state.js"></script>

  <!-- Basis -->
  <style>
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    .card { border:1px solid var(--border); border-radius:12px; padding:14px; margin:12px; background:var(--card-bg); }
    .row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .grow { flex:1; min-width:160px; }
    .muted { color: var(--muted); font-size: 13px; }
    .toolbar { display:flex; gap:10px; flex-wrap:wrap; }
    nav.app { position:sticky; top:0; z-index:5; background:var(--bg); border-bottom:1px solid var(--border); padding:8px 12px; display:flex; gap:8px; align-items:center; }
    nav.app .tag { font-size:12px; opacity:.7; margin-left:auto; }
    .btn { background:var(--btn-bg); border:1px solid var(--btn-border); border-radius:10px; padding:8px 12px; }
    .link { text-decoration:none; border:1px solid var(--border); padding:6px 10px; border-radius:999px; }
  </style>

  <!-- Del CSS -->
  <link rel="stylesheet" href="./del-B.css">
  <link rel="stylesheet" href="./del-F.css">
  <link rel="stylesheet" href="./del-C.css">
</head>
<body>

  <nav class="app">
    <a class="link" href="#home">Hjem</a>
    <a class="link" href="#work">Under arbeid</a>
    <a class="link" href="#service">Service</a>
    <a class="link" href="#status">Status</a>
    <span class="tag">v <script>document.write(window.APP_CFG.APP_VER||'');</script></span>
  </nav>

  <!-- ===== Del-A (Hjem) ===== -->
  <section class="card" id="home">
    <h2 style="margin:0 0 8px 0;">Hjem</h2>

    <div class="row" style="margin-top:6px;">
      <label for="a_driver" style="min-width:96px;">Fører-navn</label>
      <input id="a_driver" type="text" placeholder="Navn" class="grow">
    </div>

    <div class="row" style="margin-top:8px;">
      <span style="min-width:96px;">Retning rute</span>
      <label><input type="radio" name="a_dir" value="Normal" checked> Normal</label>
      <label><input type="radio" name="a_dir" value="Motsatt"> Motsatt</label>
    </div>

    <div class="row" style="margin-top:8px; flex-direction:column; align-items:flex-start;">
      <span>Utstyr (på traktoren)</span>
      <label style="margin-top:4px;"><input type="checkbox" id="a_eq_plow"> Skjær</label>
      <label style="margin-top:4px;"><input type="checkbox" id="a_eq_fres"> Fres</label>
      <label style="margin-top:4px;"><input type="checkbox" id="a_eq_sand"> Strøkasse</label>
    </div>

    <div class="row" style="margin-top:8px;">
      <span style="min-width:96px;">Oppdragstype</span>
      <label><input type="radio" name="a_job" value="SNØ" checked> Snø</label>
      <label><input type="radio" name="a_job" value="GRUS"> Grus</label>
    </div>

    <div class="row" style="margin-top:8px;">
      <span style="min-width:96px;">Tema</span>
      <select id="a_theme">
        <option value="auto">Automatisk (følg system)</option>
        <option value="light">Lys</option>
        <option value="dark">Mørk</option>
      </select>
      <span class="muted">Gjelder for alle sider</span>
    </div>

    <div id="a_hint" class="muted" style="margin-top:6px;"></div>

    <div class="toolbar" style="margin-top:10px;">
      <button id="a_start" class="btn">🏁 Start runde</button>
    </div>

    <div class="muted" style="margin-top:6px;">
      Tips: Du kan ha Skjær/Fres påmontert selv om Oppdragstype = Grus.
    </div>
  </section>

  <!-- ===== Del-B (Under arbeid) ===== -->
  <section id="work" class="work-wrap card">
    <header class="work-head">
      <div class="work-meta">
        <h2 class="title">Under arbeid</h2>
        <div class="pills">
          <span class="pill">Runde: <b id="b_round">–</b></span>
          <span class="pill">Oppdrag: <b id="b_job">–</b></span>
          <span class="pill">Retning: <b id="b_dir">–</b></span>
          <span class="pill">Sesong: <b id="b_season">–</b></span>
          <span class="pill">Synk: <b id="b_sync">–</b></span>
        </div>
      </div>
      <div class="head-actions">
        <button id="b_nav_top" class="btn btn-primary btn-nav">🧭 NAVIGER</button>
        <button id="b_sync_btn" class="btn">⟳ Synk</button>
        <button id="b_save_btn" class="btn">💾 Lagre</button>
        <button id="b_finish_btn" class="btn btn-primary">🏁 Avslutt runde</button>
      </div>
    </header>

    <div class="progress-all" aria-label="Progresjon">
      <div id="b_prog_other" class="bar bar-other" style="width:0%"></div>
      <div id="b_prog_me"    class="bar bar-me"    style="width:0%"></div>
    </div>

    <div id="b_hint" class="hint muted"></div>

    <div class="now-next">
      <div class="now">
        <div class="lbl">Nå</div>
        <div class="val" id="b_now">–</div>
      </div>
      <div class="next">
        <div class="lbl">Neste</div>
        <div class="val" id="b_next">–</div>
      </div>
    </div>

    <section id="card" class="card-big">
      <header class="card-head">
        <div class="idx"><span id="b_index">0</span>/<span id="b_total">0</span></div>
        <button id="b_nav" class="btn btn-ghost">🧭 Naviger</button>
      </header>

      <div class="card-body">
        <h3 id="b_name" class="addr"></h3>
        <div id="b_group" class="muted"></div>
        <div id="b_equipment" class="muted"></div>

        <div class="stikker-line">
          <span class="badge">Brøytestikker (sesong)</span>
          <span id="b_stikker_count" class="badge badge-info">—</span>
          <label class="stikker-check">
            <input type="checkbox" id="b_stikker_chk">
            <span id="b_stikker_lbl">Stikker satt</span>
          </label>
        </div>

        <div id="b_times" class="muted times">
          <span id="b_started">Start: –</span>
          <span id="b_finished" class="hide-on-idle"> • Ferdig: –</span>
        </div>
      </div>

      <div class="actions-grid">
        <button id="act_start" class="btn btn-lg">▶️ Start</button>
        <button id="act_skip" class="btn btn-lg">⏭ Hopp over</button>
        <button id="act_block" class="btn btn-lg">🚫 Ikke mulig</button>
        <button id="act_done"  class="btn btn-lg btn-affirm">✅ Ferdig</button>
        <button id="act_acc"   class="btn btn-lg btn-warn">⚠️ Uhell</button>
      </div>

      <div id="b_status" class="status muted"></div>
    </section>

    <footer class="work-foot">
      <button id="prev_btn" class="btn btn-wide">← Forrige</button>
      <button id="next_btn" class="btn btn-wide">Neste →</button>
    </footer>
  </section>

  <!-- ===== Del-F (Service) ===== -->
  <section id="service" class="svc-wrap card">
    <header class="svc-head">
      <h2>Service</h2>
      <div id="svc_required_banner" class="svc-banner hidden">
        <strong>Denne runden krever service før avslutning.</strong>
        <div class="muted">Runde <span data-round>–</span> • Sjåfør <span data-driver>–</span></div>
      </div>
    </header>

    <p class="muted">Huk av det som ble gjort etter runden.</p>

    <div class="svc-list">
      <label><input type="checkbox" data-svc="plow_grease"> Skjær smurt</label>
      <label><input type="checkbox" data-svc="fres_grease"> Fres smurt</label>
      <label><input type="checkbox" data-svc="front_grease"> Forstilling smurt</label>

      <label><input type="checkbox" data-svc="oil_front"> Oljenivå sjekket foran</label>
      <label><input type="checkbox" data-svc="oil_back"> Oljenivå sjekket bak</label>
      <label><input type="checkbox" data-svc="oil_refill"> Etterfylt olje</label>

      <label><input type="checkbox" data-svc="fuel_filled"> Fylt diesel</label>
      <label><input type="checkbox" data-svc="other"> Annet utført</label>
    </div>

    <label class="svc-notes">
      <div class="muted">Notater …</div>
      <textarea id="svc_notes" rows="4" placeholder="Fritekst"></textarea>
    </label>

    <div class="svc-actions">
      <button id="svc_save" class="btn btn-affirm">💾 Lagre service</button>
      <button id="svc_finish" class="btn btn-primary">🏁 Fullfør runde</button>
    </div>
  </section>

  <!-- ===== Del-C (Status / Oversikt) ===== -->
  <section id="status" class="status-wrap card">
    <header class="status-head">
      <h2>Status</h2>
      <div class="filters">
        <button id="c_sync" class="btn">⟳ Oppdater</button>
        <label class="inline">
          Vis:
          <select id="c_scope">
            <option value="ALLE">Alle</option>
            <option value="SNO">Snø</option>
            <option value="GRUS">Grus</option>
          </select>
        </label>
        <label class="inline grow">
          Søk:
          <input id="c_search" type="text" placeholder="Søk navn/gruppe…">
        </label>
        <span class="muted small" id="c_counts">—</span>
      </div>
    </header>

    <div class="table-wrap">
      <table class="tbl" id="c_table" aria-label="Adresse-status">
        <thead>
          <tr>
            <th>#</th>
            <th>Adresse</th>
            <th>Gruppe</th>
            <th>Status</th>
            <th>Start</th>
            <th>Ferdig</th>
            <th>Utført av</th>
            <th>Stikker</th>
          </tr>
        </thead>
        <tbody id="c_tbody"></tbody>
      </table>
    </div>
  </section>

  <!-- JS -->
  <script src="./del-A.js"></script>
  <script src="./del-B.js"></script>
  <script src="./del-F.js"></script>
  <script src="./del-C.js"></script>

  <!-- Enkel hash-router -->
  <script>
    function show(hash) {
      if (!hash) hash = '#home';
      const id = hash.replace('#','');
      ['home','work','service','status'].forEach(s => {
        const el = document.getElementById(s);
        if (el) el.style.display = (s === id) ? '' : 'none';
      });
      window.scrollTo({ top: 0, behavior: 'instant' });
    }
    window.addEventListener('hashchange', () => show(location.hash));
    if (!location.hash) location.hash = '#home';
    show(location.hash);
    window.APP = window.APP || {};
    window.APP.go = (id) => { location.hash = '#'+id; };
  </script>
</body>
</html>