<!doctype html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="color-scheme" content="light dark" />
  <meta name="theme-color" content="#0b1320" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Brøyterute</title>

  <link rel="stylesheet" href="css/styles.css" />
</head>

<body>
  <!-- Toppmeny -->
  <header class="appbar">
    <button id="btnMenu" class="icon-btn" aria-label="Meny">≡</button>
    <div class="appbar-title">Brøyterute</div>
    <div class="appbar-right">
      <span id="sync_badge" class="badge"><span class="dot dot-unknown"></span> Synk: ukjent</span>
      <span id="wl_badge" class="badge"><span id="wl_dot" class="dot dot-off"></span></span>
    </div>
  </header>

  <!-- Skjermmørker og meny -->
  <div id="scrim"></div>
  <aside id="drawer" class="drawer">
    <div class="drawer-header">
      <strong>Brøyterute</strong>
      <button id="btnCloseDrawer" class="icon-btn" aria-label="Lukk">×</button>
    </div>

    <div class="drawer-content">
      <nav>
        <div class="drawer-section">Navigasjon</div>
        <ul class="drawer-list">
          <li><a class="drawer-link" data-go="home">🏠 Hjem</a></li>
          <li><a class="drawer-link" data-go="work">🧭 Under arbeid</a></li>
          <li><a class="drawer-link" data-go="service">🛠 Service</a></li>
          <li><a class="drawer-link" data-go="status">📊 Status</a></li>
          <li><a class="drawer-link" data-go="admin">⚙️ Admin</a></li>
        </ul>

        <div class="drawer-section">Skjerm</div>
        <div class="card row" style="align-items:center; justify-content:space-between">
          <button id="qk_wl" class="btn-ghost"><span id="qk_wl_dot" class="dot dot-off"></span> Hold skjerm våken</button>
          <span id="qk_wl_status" class="muted">Status: av</span>
        </div>

        <div class="drawer-section">Tema</div>
        <div class="card row" style="align-items:center; justify-content:space-between">
          <button id="theme_toggle" class="btn-ghost">🌓 Bytt tema</button>
          <span id="theme_status" class="muted">System</span>
        </div>
      </nav>
    </div>
  </aside>

  <!-- Innhold -->
  <main>
    <!-- HJEM -->
    <section id="home">
      <h1>Hjem</h1>

      <label class="field">
        <span>Fører</span>
        <input id="a_driver" class="input" placeholder="Navn" />
      </label>

      <label class="field">
        <span>Utstyr</span>
        <div class="input-like">
          <div class="checkbox-col">
            <label><input id="a_eq_plow" type="checkbox" /> Skjær</label>
            <label><input id="a_eq_fres" type="checkbox" /> Fres</label>
            <label><input id="a_eq_sand" type="checkbox" /> Sand/Grus</label>
          </div>
        </div>
      </label>

      <label class="field">
        <span>Rekkefølge</span>
        <div class="row" style="gap:18px; align-items:center">
          <select id="a_dir" class="input" style="flex:1;max-width:320px">
            <option>Normal</option>
            <option>Motsatt</option>
          </select>

          <div class="checkbox-row">
            <input id="a_autoNav" type="checkbox" />
            <span class="muted-strong">Auto-naviger</span>
          </div>
        </div>
      </label>

      <button id="a_start" class="btn btn-primary">Start runde</button>
    </section>

    <section id="work" hidden><h1>Under arbeid</h1></section>
    <section id="service" hidden><h1>Service</h1></section>
    <section id="status" hidden><h1>Status</h1></section>
    <section id="admin" hidden><h1>Admin</h1></section>
  </main>

  <!-- JS -->
  <script>
  (() => {
    const $ = (s,r=document)=>r.querySelector(s);

    // Drawer
    const scrim = $('#scrim');
    const drawer = $('#drawer');
    $('#btnMenu')?.addEventListener('click',()=>{drawer.classList.add('show');scrim.classList.add('show');});
    $('#btnCloseDrawer')?.addEventListener('click',()=>{drawer.classList.remove('show');scrim.classList.remove('show');});
    scrim?.addEventListener('click',()=>{drawer.classList.remove('show');scrim.classList.remove('show');});
    document.querySelectorAll('.drawer-link').forEach(a=>{
      a.addEventListener('click',e=>{
        e.preventDefault();
        const id=a.dataset.go; if(id) location.hash='#'+id;
        drawer.classList.remove('show');scrim.classList.remove('show');
      });
    });

    // Wake Lock
    const wlDot = $('#wl_dot'), wlDot2 = $('#qk_wl_dot'), wlStatus = $('#qk_wl_status'), wlBtn = $('#qk_wl');
    let wakeLock = null;

    function paintWL(on){
      const cls = on?'dot dot-ok':'dot dot-off';
      wlDot.className=cls; wlDot2.className=cls;
      wlStatus.textContent='Status: '+(on?'på':'av');
    }

    async function reqWL(){
      try{
        wakeLock=await navigator.wakeLock.request('screen');
        paintWL(true);
        wakeLock.addEventListener('release',()=>{paintWL(false);wakeLock=null;});
        localStorage.setItem('BRYT_WL','1');
      }catch{paintWL(false);}
    }

    async function relWL(){
      try{await wakeLock?.release();}catch{}
      wakeLock=null;paintWL(false);localStorage.removeItem('BRYT_WL');
    }

    wlBtn?.addEventListener('click',()=>wakeLock?relWL():reqWL());
    document.addEventListener('visibilitychange',()=>{if(document.visibilityState==='visible'&&localStorage.getItem('BRYT_WL')==='1')reqWL();});
    if(localStorage.getItem('BRYT_WL')==='1')reqWL();else paintWL(false);

    // Tema-bryter
    const tBtn = $('#theme_toggle');
    const tStatus = $('#theme_status');

    function applyTheme(t){
      document.documentElement.dataset.theme=t;
      localStorage.setItem('BRYT_THEME',t);
      tStatus.textContent = t==='dark'?'Mørk':t==='light'?'Lys':'System';
      if(t==='dark')document.documentElement.classList.add('dark');
      else document.documentElement.classList.remove('dark');
    }

    tBtn?.addEventListener('click',()=>{
      const cur=document.documentElement.dataset.theme||'system';
      const next=cur==='dark'?'light':cur==='light'?'system':'dark';
      applyTheme(next);
    });

    applyTheme(localStorage.getItem('BRYT_THEME')||'system');
  })();
  </script>
</body>
</html>