<!doctype html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Br√∏yterute</title>

  <style>
    :root {
      --bg: #0f172a;        /* m√∏rk bakgrunn */
      --fg: #e5e7eb;        /* lys tekst */
      --muted: #94a3b8;
      --acc: #22c55e;       /* gr√∏nn */
      --warn: #ef4444;      /* r√∏d */
      --card: #111827;
      --line: #1f2937;
      --btn: #1f2937;
      --btn-fg: #e5e7eb;
      --btn-ghost-fg:#cbd5e1;
    }
    html, body {
      height: 100%;
      margin: 0;
      background: var(--bg);
      color: var(--fg);
      -webkit-user-select: none;
      user-select: none;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
    }

    /* Appbar on top, below status/notch */
    .appbar {
      position: sticky;
      top: 0;
      z-index: 1000;
      padding: calc(env(safe-area-inset-top) + 10px) 12px 10px 12px;
      background: rgba(15,23,42,.9);
      backdrop-filter: blur(6px);
      border-bottom: 1px solid var(--line);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .appbar-title {
      font-weight: 600;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .spacer { flex: 1; }

    .dot {
      width: 10px; height: 10px; border-radius: 50%;
      display: inline-block;
      margin-left: 6px;
      box-shadow: 0 0 0 2px rgba(0,0,0,.2);
    }
    .dot.red { background: var(--warn); }
    .dot.green { background: var(--acc); }

    main {
      padding: 16px;
      padding-bottom: calc(env(safe-area-inset-bottom) + 24px);
    }
    h2 { margin: 0 0 8px 0; font-size: 18px; }
    .muted { color: var(--muted); }
    .row { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }

    .card {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 12px;
    }

    .btn {
      background: var(--btn);
      color: var(--btn-fg);
      border: 1px solid var(--line);
      padding: 10px 12px;
      border-radius: 10px;
      font-size: 15px;
    }
    .btn-ghost {
      background: transparent;
      color: var(--btn-ghost-fg);
      border: 1px solid var(--line);
      padding: 8px 10px; border-radius: 8px;
    }

    /* Drawer (hamburger) */
    #scrim {
      position: fixed; inset: 0; background: rgba(0,0,0,.45);
      display: none; z-index: 1400;
    }
    #scrim.show { display: block; }

    #drawer {
      position: fixed; top: 0; left: 0; bottom: 0; width: 300px;
      background: #0b1222; border-right: 1px solid var(--line);
      transform: translateX(-100%);
      transition: transform .18s ease-out;
      z-index: 1500; padding-top: calc(env(safe-area-inset-top) + 8px);
      display: flex; flex-direction: column;
    }
    #drawer.open { transform: translateX(0); }
    .drawer-head { display:flex; align-items:center; justify-content:space-between; padding: 12px 14px; }
    .drawer-title { font-weight: 600; }
    .drawer-menu {
      padding: 8px 8px 24px;
      overflow: auto;
    }
    .drawer-link {
      width: 100%;
      text-align: left;
      background: transparent;
      border: 1px solid transparent;
      color: var(--fg);
      padding: 12px 10px;
      border-radius: 10px;
      font-size: 16px;
      display: block;
    }
    .drawer-link:hover { background: rgba(255,255,255,.04); }
    .drawer-sep { height: 18px; }
    .drawer-sep-double { height: 26px; } /* ~ to linjer */

    /* Tabelldeler i Status */
    table { width: 100%; border-collapse: collapse; }
    th, td { border-bottom: 1px solid var(--line); padding: 8px; text-align: left; }
    th { color: var(--muted); font-weight: 600; }

    /* Progress bar */
    .bar {
      height: 8px; background: #0b1324; border: 1px solid var(--line);
      border-radius: 999px; overflow: hidden;
    }
    .bar > div { height: 100%; float: left; }
    #b_prog_me { background: #7c3aed; }     /* lilla */
    #b_prog_other { background: #22c55e; }  /* gr√∏nn */
  </style>
</head>
<body>

  <!-- Scrim og Drawer -->
  <div id="scrim"></div>
  <aside id="drawer" aria-hidden="true">
    <div class="drawer-head">
      <div class="drawer-title">Meny</div>
      <button id="btnCloseDrawer" class="btn-ghost">Lukk ‚úï</button>
    </div>
    <div class="drawer-menu">
      <!-- vanlige sider -->
      <button class="drawer-link" data-go="home">Hjem</button>
      <button class="drawer-link" data-go="work">Under arbeid</button>
      <button class="drawer-link" data-go="service">Service</button>
      <button class="drawer-link" data-go="status">Status</button>
      <button class="drawer-link" data-go="admin">Admin</button>

      <!-- ‚Äúto linjer ned‚Äù f√∏r quick actions -->
      <div class="drawer-sep-double"></div>

      <!-- ser like ut som over, men er actions -->
      <button id="qk_grus" class="drawer-link">Hent grus</button>
      <button id="qk_diesel" class="drawer-link">Fyll diesel</button>
      <button id="qk_base" class="drawer-link">Til base</button>
    </div>
  </aside>

  <!-- Appbar -->
  <header class="appbar">
    <button id="btnMenu" class="btn-ghost">‚ò∞</button>
    <div class="appbar-title">
      Br√∏yterute
      <!-- Sync-status og wake-indikator -->
      <span id="sync_badge" class="muted">Synk: ukjent</span>
      <span id="sync_time" class="muted"></span>
    </div>
    <div class="spacer"></div>
    <div title="Skjerm-l√•s status">
      <span id="wl_dot" class="dot red"></span>
    </div>
  </header>

  <main>
    <!-- HJEM -->
    <section id="home" class="card">
      <h2>Hjem</h2>
      <div class="row">
        <label class="muted">Hold skjerm v√•ken:</label>
        <button id="qk_wl" class="btn">Veksle</button>
        <span id="qk_wl_status" class="muted">Status: av</span>
      </div>

      <div style="height:8px"></div>

      <div class="row">
        <button id="qk_grus" class="btn">Hent grus</button>
        <button id="qk_diesel" class="btn">Fyll diesel</button>
        <button id="qk_base" class="btn">Til base</button>
      </div>

      <div style="height:10px"></div>

      <div class="row">
        Sj√•f√∏r:
        <input id="a_driver" placeholder="navn" class="btn-ghost" style="flex:1; max-width:220px">
        Retning:
        <select id="a_dir" class="btn-ghost">
          <option>Normal</option>
          <option>Motsatt</option>
        </select>
      </div>
      <div class="row">
        Utstyr:
        <label><input type="checkbox" id="a_eq_plow"> Plog</label>
        <label><input type="checkbox" id="a_eq_fres"> Fres</label>
        <label><input type="checkbox" id="a_eq_sand"> Sand/Grus</label>
        <label style="margin-left:8px"><input type="checkbox" id="a_autoNav"> Auto-naviger</label>
      </div>
      <div style="height:8px"></div>
      <button id="a_start" class="btn">Start runde</button>
    </section>

    <div style="height:12px"></div>

    <!-- UNDER ARBEID -->
    <section id="work" class="card" style="display:none">
      <h2>Under arbeid</h2>
      <div class="row"><div class="bar" style="flex:1"><div id="b_prog_me" style="width:0%"></div><div id="b_prog_other" style="width:0%"></div></div></div>
      <div class="row"><strong>N√•:</strong><span id="b_now">‚Äî</span></div>
      <div class="row"><strong>Neste:</strong><span id="b_next">‚Äî</span></div>
      <div class="row">
        <span class="muted">Retning:</span><span id="b_dir">Normal</span>
        <span class="muted" style="margin-left:10px">Oppgave:</span><span id="b_task">Sn√∏</span>
        <span class="muted" style="margin-left:10px">Status:</span><span id="b_status">‚Äî</span>
      </div>
      <div style="height:10px"></div>
      <div class="row">
        <button id="act_start" class="btn">Start</button>
        <button id="act_done"  class="btn">Ferdig</button>
        <button id="act_skip"  class="btn-ghost">Hopp over</button>
        <button id="act_block" class="btn-ghost">Ikke mulig</button>
        <button id="act_acc"   class="btn-ghost">Uhell</button>
        <button id="act_nav"   class="btn">Naviger</button>
      </div>
    </section>

    <div style="height:12px"></div>

    <!-- SERVICE -->
    <section id="service" class="card" style="display:none">
      <h2>Service</h2>
      <p class="muted">Her kan det komme logg senere.</p>
    </section>

    <div style="height:12px"></div>

    <!-- STATUS -->
    <section id="status" class="card" style="display:none">
      <h2>Status</h2>
      <div class="row">
        <span id="st_season_badge" class="muted">Sesong: ‚Äî</span>
        <span class="spacer"></span>
        <button id="st_reload" class="btn-ghost">Oppdater</button>
        <select id="st_mode" class="btn-ghost">
          <option value="snow" selected>Sn√∏</option>
          <option value="grit">Grus</option>
        </select>
        <select id="st_filter" class="btn-ghost">
          <option value="alle">Alle</option>
          <option value="ikke">Ikke p√•begynt</option>
          <option value="p√•g√•r">P√•g√•r</option>
          <option value="ferdig">Ferdig</option>
          <option value="hoppet">Hoppet over</option>
          <option value="umulig">Ikke mulig</option>
          <option value="uhell">Uhell</option>
        </select>
        <button id="st_lock_toggle" class="btn-ghost">üîì L√•s stikker (sesong)</button>
      </div>
      <div style="height:10px"></div>
      <div id="st_summary" class="muted"></div>
      <div style="height:8px"></div>
      <div class="card" style="background:#0b1222">
        <div style="overflow:auto">
          <table>
            <thead>
              <tr>
                <th>#</th><th>Adresse</th><th>Oppdrag</th><th>Stikker</th><th>Kart</th>
                <th>Status</th><th>Start</th><th>Ferdig</th><th>Utf√∏rt av</th><th>Foto</th>
              </tr>
            </thead>
            <tbody id="st_tbody"></tbody>
          </table>
        </div>
      </div>
    </section>

    <div style="height:12px"></div>

    <!-- ADMIN -->
    <section id="admin" class="card" style="display:none">
      <h2>Admin</h2>
      <div class="card">
        <div class="row">
          <input id="adm_geturl" class="btn-ghost" placeholder="GET URL" style="flex:1">
          <input id="adm_puturl" class="btn-ghost" placeholder="PUT URL" style="flex:1">
        </div>
        <div class="row">
          <button id="adm_urls_save" class="btn">Lagre URL-er</button>
          <button id="adm_urls_clear" class="btn-ghost">Fjern URL-er</button>
          <span id="adm_urls_status" class="muted">Mangler noe‚Ä¶</span>
        </div>
      </div>

      <div style="height:10px"></div>

      <div class="card">
        <div class="row">
          <input id="adm_key" class="btn-ghost" placeholder="X-Master-Key" style="flex:1">
          <button id="adm_key_save" class="btn">Lagre n√∏kkel</button>
          <button id="adm_key_clear" class="btn-ghost">Fjern n√∏kkel</button>
          <span id="adm_key_status" class="muted"></span>
        </div>
      </div>

      <div style="height:10px"></div>

      <div class="card">
        <div class="row">
          <input id="adm_grus"   class="btn-ghost" placeholder="Grus depot (lat,lon)" style="flex:1">
          <input id="adm_diesel" class="btn-ghost" placeholder="Diesel (lat,lon)" style="flex:1">
          <input id="adm_base"   class="btn-ghost" placeholder="Base (lat,lon)" style="flex:1">
        </div>
        <div class="row">
          <button id="adm_stakes_lock" class="btn-ghost">üîì L√•s stikker</button>
          <button id="adm_addr_fetch" class="btn-ghost">Hent fra sky</button>
          <button id="adm_addr_save"  class="btn">Lagre adresser</button>
          <span id="adm_addr_msg" class="muted"></span>
        </div>
      </div>

      <div style="height:10px"></div>

      <div class="card">
        <div style="overflow:auto">
          <table>
            <thead>
              <tr>
                <th>Aktiv</th><th>Adresse</th><th>Gruppe</th><th>Sn√∏</th><th>Grus</th><th>Stikker</th><th>Koordinater</th><th>Rekkef√∏lge</th>
              </tr>
            </thead>
            <tbody id="adm_addr_tbody"></tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  <!-- Del-D JS (oppdater v= for √• tvinge ny versjon ved endring) -->
  <script src="del-d.js?v=10413" defer></script>

  <!-- Liten hjelpe-script i index for wake-prikk (gr√∏nn/r√∏d) og safe fallback -->
  <script>
    // Oppdater gr√∏nn/r√∏d prikk n√•r teksten endres av del-d.js
    document.addEventListener('DOMContentLoaded', () => {
      const dot = document.getElementById('wl_dot');
      const note = document.getElementById('qk_wl_status');
      const apply = () => {
        if (!dot || !note) return;
        const t = (note.textContent || '').toLowerCase();
        // "p√•" = aktiv (gr√∏nn). Alt annet = r√∏d.
        if (t.includes('p√•')) { dot.classList.remove('red'); dot.classList.add('green'); }
        else { dot.classList.remove('green'); dot.classList.add('red'); }
      };
      // initial
      apply();
      // observer for endringer
      if (window.MutationObserver && note) {
        new MutationObserver(apply).observe(note, { childList: true, characterData: true, subtree: true });
      }
    });
  </script>
</body>
</html>