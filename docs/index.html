<!doctype html>
<html lang="no">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Br√∏yterute ‚Äì Romerike Trefelling (V9.3.3)</title>
<meta name="theme-color" content="#0f9d58">
<style>
  :root{
    --bg:#111; --fg:#f4f6f8; --muted:#b8c0c7;
    --card:#1a1a1a; --cardBorder:#2a2a2a;
    --green:#0f9d58; --red:#c21d03; --blue:#0061fe; --gray:#2f3337;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  body{background:var(--bg);color:var(--fg)}
  #app{min-height:100%;display:grid;grid-template-rows:auto 1fr auto}
  header{background:#0b0b0b;color:#fff;padding:10px 12px;display:flex;align-items:center;gap:10px}
  header h1{font-size:16px;margin:0}
  .spacer{flex:1}
  .nav{display:flex;gap:8px}
  .nav .tab{border:none;border-radius:12px;padding:8px 12px;background:#2a2a2a;color:#fff;cursor:pointer}
  .nav .tab.active{background:var(--green)}
  .page{display:none;padding:14px}
  .page.active{display:block}
  .card{background:var(--card);border:1px solid var(--cardBorder);border-radius:16px;padding:14px}
  .stack{display:flex;flex-direction:column;gap:12px}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .title-lg{font-size:26px;font-weight:700}
  .muted{color:var(--muted)}
  .btn{border:none;border-radius:14px;font-size:17px;font-weight:700;cursor:pointer}
  .btn.s{height:38px;font-size:14px;border:1px solid var(--cardBorder);background:#222;color:#fff}
  .btn-green{background:var(--green);color:#fff}
  .btn-red{background:var(--red);color:#fff}
  .btn-blue{background:var(--blue);color:#fff}
  .btn-gray{background:var(--gray);color:#fff}
  .item{background:var(--card);border:1px solid var(--cardBorder);border-radius:12px;padding:10px;margin-bottom:8px}
  .item.disabled{opacity:.5}
  .footer{background:#0b0b0b;color:#fff;padding:8px 12px;display:flex;justify-content:space-between;font-size:12px}
  input,select,textarea{background:transparent;color:inherit;border:1px solid var(--cardBorder);border-radius:10px;padding:8px}
</style>
</head>
<body>
<div id="app">
  <header>
    <h1>Br√∏yterute ‚Äì Romerike Trefelling</h1>
    <div class="spacer"></div>
    <div class="nav">
      <button type="button" class="tab active" data-tab="home">Hjem</button>
      <button type="button" class="tab" data-tab="work">Under arbeid</button>
      <button type="button" class="tab" data-tab="register">Adresse-register</button>
      <button type="button" class="tab" data-tab="service">Service</button>
    </div>
  </header>

  <!-- HJEM -->
  <div id="page-home" class="page active">
    <div class="card stack">
      <h2>Innstillinger</h2>
      <div class="row">
        <label style="min-width:90px;align-self:center">Sj√•f√∏r</label>
        <input id="driver" type="text" placeholder="Skriv inn navnet ditt" style="flex:1;min-width:220px">
      </div>
      <div class="row">
        <label><input id="eq_plog" type="checkbox"> Plog</label>
        <label><input id="eq_fres" type="checkbox"> Fres</label>
        <label><input id="eq_stro" type="checkbox"> Str√∏kasse</label>
      </div>
      <div class="row" style="justify-content:flex-end;gap:8px">
        <button id="btnRoundByEquip" type="button" class="btn btn-blue">Start ny runde (etter utstyr)</button>
        <button id="btnResetAll" type="button" class="btn btn-red">Nullstill alle status</button>
        <button id="btnStart" type="button" class="btn btn-green">Start runde ‚Üí</button>
      </div>
    </div>
  </div>

  <!-- UNDER ARBEID -->
  <div id="page-work" class="page">
    <div class="card stack">
      <div id="driverLbl" class="muted">Sj√•f√∏r: ‚Äî</div>
      <h2 id="curName" class="title-lg">‚Äî</h2>
      <div class="muted">Oppgave: <span id="curTask">‚Äî</span></div>
      <div class="muted">Neste: <span id="curNext">‚Äî</span></div>
      <div class="row">
        <button id="ongo"  type="button" class="btn btn-gray">‚ñ∂Ô∏è P√•g√•r</button>
        <button id="done"  type="button" class="btn btn-green">‚úÖ Ferdig</button>
        <button id="block" type="button" class="btn btn-red">‚õî Ikke mulig</button>
        <button id="nav"   type="button" class="btn btn-blue">üß≠ Naviger</button>
        <button id="next"  type="button" class="btn btn-gray">üîÅ Neste</button>
      </div>
    </div>
  </div>

  <!-- REGISTER -->
  <div id="page-register" class="page">
    <div id="list"></div>
    <div class="card stack">
      <div class="row">
        <input id="addr" type="text" placeholder="Adresse / omr√•de" style="flex:2">
        <select id="taskSel" style="flex:1">
          <option>Br√∏yte</option><option>Frese</option><option>Str√∏</option>
          <option>Br√∏yte og str√∏</option><option>Frese og str√∏</option><option>Br√∏ytestikker</option>
        </select>
        <button id="add" type="button" class="btn btn-green">+ Legg til</button>
      </div>
    </div>
  </div>

  <!-- SERVICE -->
  <div id="page-service" class="page">
    <div class="card stack">
      <h2>Service / Vedlikehold</h2>
      <div class="row">
        <label><input id="svc_plog" type="checkbox"> Smurt plog</label>
        <label><input id="svc_fres" type="checkbox"> Smurt fres</label>
        <label><input id="svc_stro" type="checkbox"> Smurt str√∏kasse</label>
        <label><input id="svc_other" type="checkbox"> Annet</label>
      </div>
      <textarea id="svcNotes" placeholder="Anmerkninger ‚Ä¶" style="width:100%;min-height:100px"></textarea>
    </div>
  </div>

  <div class="footer">
    <div id="pos">‚Äî</div>
    <div>Versjon 9.3.3</div>
  </div>
</div>
<script>
/* --- Br√∏yterute V9.3.3 logikk --- */
document.addEventListener('DOMContentLoaded',function(){
  const $=id=>document.getElementById(id);
  const save=()=>localStorage.setItem('broyte_state',JSON.stringify(state));
  const load=()=>{try{return JSON.parse(localStorage.getItem('broyte_state')||'');}catch(e){return null;}};
  const show=t=>['home','work','register','service'].forEach(p=>{
      $('page-'+p).classList.toggle('active',p===t);
      document.querySelector('.tab[data-tab="'+p+'"]').classList.toggle('active',p===t);
  });
  const taskNeeds=(t,type)=>{
    if(type==='plog')return/Br√∏yte/.test(t);
    if(type==='fres')return/Frese/.test(t);
    if(type==='stro')return/Str√∏/.test(t);
    return false;
  };
  const isCompatible=s=>{
    const t=s.t||'';
    if(taskNeeds(t,'plog')&&!state.equipment.plog)return false;
    if(taskNeeds(t,'fres')&&!state.equipment.fres)return false;
    if(taskNeeds(t,'stro')&&!state.equipment.stro)return false;
    return true;
  };

  let state=load()||{
    driver:'',
    equipment:{plog:true,fres:false,stro:false},
    stops:[
      {n:'AMFI Eidsvoll (R√•holt)',t:'Br√∏yte',f:false,b:false},
      {n:'R√•holt barneskole',t:'Br√∏yte og str√∏',f:false,b:false},
      {n:'R√•holt ungdomsskole',t:'Frese',f:false,b:false},
      {n:'Dal stasjon',t:'Str√∏',f:false,b:false}
    ]
  };

  document.querySelectorAll('.tab').forEach(b=>b.onclick=()=>{show(b.dataset.tab);if(b.dataset.tab==='register')renderList();if(b.dataset.tab==='work')renderWork();});
  $('driver').value=state.driver||'';$('driver').oninput=e=>{state.driver=e.target.value.trim();save();};
  ['plog','fres','stro'].forEach(k=>{
    $('eq_'+k).checked=!!state.equipment[k];
    $('eq_'+k).onchange=e=>{state.equipment[k]=e.target.checked;save();};
  });

  $('btnStart').onclick=()=>{show('work');renderWork();};
  $('btnRoundByEquip').onclick=()=>{
    if(!confirm('Nullstille status for adresser som matcher valgt utstyr?'))return;
    state.stops.forEach(s=>{if(isCompatible(s)){s.f=s.b=false;}});
    save();show('work');renderWork();alert('Ny runde for valgt utstyr.');
  };
  $('btnResetAll').onclick=()=>{
    if(!confirm('Nullstille status for ALLE adresser?'))return;
    state.stops.forEach(s=>{s.f=s.b=false;});save();show('work');renderWork();
  };

  const getCurrent=()=>{
    for(let s of state.stops)if(!s.f&&!s.b&&isCompatible(s))return s;
    for(let s of state.stops)if(!s.f&&!s.b)return s;
    return null;
  };
  const renderWork=()=>{
    const c=getCurrent();
    $('driverLbl').textContent='Sj√•f√∏r: '+(state.driver||'‚Äî');
    $('curName').textContent=c?c.n:'‚Äî';
    $('curTask').textContent=c?c.t:'‚Äî';
    $('curNext').textContent=(state.stops.find((s,i)=>s===c?state.stops[i+1]:false)||{}).n||'‚Äî';
  };

  const markDone=s=>{s.f=true;save();};
  $('done').onclick=()=>{
    const c=getCurrent();if(!c)return;
    if(c.t==='Br√∏ytestikker'){const n=prompt('Antall br√∏ytestikker?','');if(n===null)return;c.details='Br√∏ytestikker: '+(+n||0);}
    markDone(c);renderWork();
    const nxt=getCurrent();
    if(nxt)window.location.href='https://www.google.com/maps/dir/?api=1&destination='+encodeURIComponent(nxt.n);
    else alert('Ingen flere adresser. G√• til Hjem for ny runde.');
  };
  $('block').onclick=()=>{
    const c=getCurrent();if(!c)return;
    const r=prompt('Hvorfor ikke mulig √• utf√∏re?','')||'';if(r)c.details=(c.details?c.details+' ¬∑ ':'')+'√Örsak: '+r;
    c.b=true;save();renderWork();
  };
  $('nav').onclick=()=>{const c=getCurrent();if(c)window.location.href='https://www.google.com/maps/dir/?api=1&destination='+encodeURIComponent(c.n);};
  $('next').onclick=()=>{
    const c=getCurrent();if(!c)return;
    if(confirm('Markere ferdig f√∏r neste?'))markDone(c);
    renderWork();const nxt=getCurrent();if(nxt)window.location.href='https://www.google.com/maps/dir/?api=1&destination='+encodeURIComponent(nxt.n);
  };

  const renderList=()=>{
    $('list').innerHTML=state.stops.map((s,i)=>`<div class='item${s.f?' disabled':''}'><b>${i+1}. ${s.n}</b><br>${s.t}${s.f?'‚úÖ':''}</div>`).join('');
  };
  $('add').onclick=()=>{
    const n=$('addr').value.trim();if(!n)return;
    state.stops.push({n,t:$('taskSel').value,f:false,b:false});$('addr').value='';save();renderList();
  };

  $('pos').textContent='Klar';
});
</script>
</body>
</html>